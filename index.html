<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>LND Measurement App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    h2 { margin-top: 40px; }
    table { border-collapse: collapse; margin-top: 10px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f4f4f4; }
    button { margin: 3px; padding: 5px 10px; cursor: pointer; }
    input[type="number"] { width: 80px; }
    input[type="text"] { width: 120px; }
    .reset-btn { background: #f55; color: #fff; }
    .section { border: 2px solid #ccc; padding: 15px; margin-bottom: 30px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>üìä LND Measurement (dB)</h1>

  <!-- ===== Section 12687 ===== -->
  <div class="section">
    <h2>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà 12687</h2>
    <form id="form12687">
      <input type="text" id="model12687" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô" required>
      <input type="number" id="value12687" placeholder="‡∏Ñ‡πà‡∏≤ dB" step="0.1" min="60" max="100" required>
      <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button type="button" class="reset-btn" onclick="resetData('12687')">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
    </form>

    <table id="table12687">
      <thead>
        <tr><th>‡∏£‡∏∏‡πà‡∏ô</th><th>‡∏Ñ‡πà‡∏≤ (dB)</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <canvas id="chart12687" height="200"></canvas>
  </div>

  <!-- ===== Section 11560 ===== -->
  <div class="section">
    <h2>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà 11560</h2>
    <form id="form11560">
      <input type="text" id="model11560" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô" required>
      <input type="number" id="value11560" placeholder="‡∏Ñ‡πà‡∏≤ dB" step="0.1" min="60" max="100" required>
      <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button type="button" class="reset-btn" onclick="resetData('11560')">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
    </form>

    <table id="table11560">
      <thead>
        <tr><th>‡∏£‡∏∏‡πà‡∏ô</th><th>‡∏Ñ‡πà‡∏≤ (dB)</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <canvas id="chart11560" height="200"></canvas>
  </div>

  <script>
    // datasets
    let data12687 = JSON.parse(localStorage.getItem("measurements12687")) || [];
    let data11560 = JSON.parse(localStorage.getItem("measurements11560")) || [];

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏µ‡πÅ‡∏ö‡∏ö 5 ‡∏£‡∏∞‡∏î‡∏±‡∏ö
    function getColor(value) {
      if (value < 70) return 'rgba(255,0,0,0.8)';      // ‡πÅ‡∏î‡∏á
      else if (value < 80) return 'rgba(255,165,0,0.8)'; // ‡∏™‡πâ‡∏°
      else if (value < 90) return 'rgba(255,255,0,0.8)'; // ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
      else if (value < 95) return 'rgba(144,238,144,0.8)'; // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô
      else return 'rgba(0,128,0,0.9)';                  // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏°
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á chart object
    const chart12687 = new Chart(document.getElementById('chart12687').getContext('2d'), {
      type: 'bar',
      data: { labels: [], datasets: [{ label: '12687 dB', data: [], backgroundColor: [] }] }
    });
    const chart11560 = new Chart(document.getElementById('chart11560').getContext('2d'), {
      type: 'bar',
      data: { labels: [], datasets: [{ label: '11560 dB', data: [], backgroundColor: [] }] }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô render
    function render(freq) {
      let dataset = (freq === '12687') ? data12687 : data11560;
      dataset.sort((a,b) => b.value - a.value);

      // ‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      const tbody = document.querySelector(`#table${freq} tbody`);
      tbody.innerHTML = '';
      dataset.forEach((d, i) => {
        tbody.innerHTML += `
          <tr>
            <td><input type="text" value="${d.model}" onchange="updateModel('${freq}',${i},this.value)"></td>
            <td><input type="number" step="0.1" min="60" max="100" value="${d.value.toFixed(1)}" onchange="updateValue('${freq}',${i},this.value)"></td>
            <td><button onclick="deleteRow('${freq}',${i})">‡∏•‡∏ö</button></td>
          </tr>`;
      });

      // ‡∏Å‡∏£‡∏≤‡∏ü
      const chart = (freq === '12687') ? chart12687 : chart11560;
      chart.data.labels = dataset.map(d => d.model);
      chart.data.datasets[0].data = dataset.map(d => d.value.toFixed(1));
      chart.data.datasets[0].backgroundColor = dataset.map(d => getColor(d.value));
      chart.update();

      // save
      localStorage.setItem("measurements"+freq, JSON.stringify(dataset));
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById('form12687').addEventListener('submit', e => {
      e.preventDefault();
      let model = document.getElementById('model12687').value.trim();
      let value = parseFloat(document.getElementById('value12687').value);
      if (!model || isNaN(value)) return;
      data12687.push({ model, value });
      e.target.reset();
      render('12687');
    });
    document.getElementById('form11560').addEventListener('submit', e => {
      e.preventDefault();
      let model = document.getElementById('model11560').value.trim();
      let value = parseFloat(document.getElementById('value11560').value);
      if (!model || isNaN(value)) return;
      data11560.push({ model, value });
      e.target.reset();
      render('11560');
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö/‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
    window.updateValue = function(freq, index, newValue) {
      let dataset = (freq==='12687') ? data12687 : data11560;
      dataset[index].value = parseFloat(newValue);
      render(freq);
    }
    window.updateModel = function(freq, index, newName) {
      let dataset = (freq==='12687') ? data12687 : data11560;
      dataset[index].model = newName;
      render(freq);
    }
    window.deleteRow = function(freq, index) {
      let dataset = (freq==='12687') ? data12687 : data11560;
      dataset.splice(index,1);
      render(freq);
    }
    window.resetData = function(freq) {
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á "+freq+" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        if (freq==='12687') data12687 = [];
        else data11560 = [];
        localStorage.removeItem("measurements"+freq);
        render(freq);
      }
    }

    // render ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    render('12687');
    render('11560');
  </script>
</body>
</html>
