<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>LND Measurement App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f4f4f4; }
    button { margin: 5px; padding: 5px 10px; cursor: pointer; }
    input[type="number"] { width: 70px; }
  </style>
</head>
<body>
  <h1>üìä LND Measurement (dB)</h1>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <form id="dataForm">
    <input type="text" id="model" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∏‡πà‡∏ô" required>
    <input type="number" id="value" placeholder="‡∏Ñ‡πà‡∏≤ dB" min="0" max="100" required>
    <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button type="button" id="resetBtn" style="background:#f55;color:#fff;">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </form>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
  <h2>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î</h2>
  <table id="dataTable">
    <thead>
      <tr>
        <th>‡∏£‡∏∏‡πà‡∏ô</th>
        <th>‡∏Ñ‡πà‡∏≤ (dB)</th>
        <th>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- ‡∏Å‡∏£‡∏≤‡∏ü -->
  <canvas id="chart" width="400" height="200"></canvas>

  <script>
    let data = JSON.parse(localStorage.getItem("measurements")) || [];

    const ctx = document.getElementById('chart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: { labels: [], datasets: [{ label: 'dB Value', data: [], backgroundColor: [] }] },
      options: { scales: { y: { min: 0, max: 100 } } }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö
    function getColor(value) {
      if (value <= 60) return "red";          // 0‚Äì20
      if (value <= 70) return "orange";       // 21‚Äì40
      if (value <= 79) return "yellow";       // 41‚Äì60
      if (value <= 100) return "lightgreen";   // 61‚Äì80
      return "green";                         // 81‚Äì100
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü
    function render() {
      data.sort((a, b) => b.value - a.value);

      // update table
      const tbody = document.querySelector('#dataTable tbody');
      tbody.innerHTML = '';
      data.forEach((d, i) => {
        tbody.innerHTML += `
          <tr>
            <td>${d.model}</td>
            <td>
              <input type="number" min="0" max="100" value="${d.value}" onchange="updateValue(${i}, this.value)">
            </td>
            <td>
              <button onclick="deleteRow(${i})">‡∏•‡∏ö</button>
            </td>
          </tr>
        `;
      });

      // update chart
      chart.data.labels = data.map(d => d.model);
      chart.data.datasets[0].data = data.map(d => d.value);
      chart.data.datasets[0].backgroundColor = data.map(d => getColor(d.value));
      chart.update();

      // save to localStorage
      localStorage.setItem("measurements", JSON.stringify(data));
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
    document.getElementById('dataForm').addEventListener('submit', e => {
      e.preventDefault();
      const model = document.getElementById('model').value.trim();
      const value = parseFloat(document.getElementById('value').value);

      if (!model || isNaN(value)) return;
      data.push({ model, value });
      e.target.reset();
      render();
    });

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById('resetBtn').addEventListener('click', () => {
      if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        data = [];
        localStorage.removeItem("measurements");
        render();
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤
    window.updateValue = function(index, newValue) {
      data[index].value = parseFloat(newValue);
      render();
    }

    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    window.deleteRow = function(index) {
      data.splice(index, 1);
      render();
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    render();
  </script>
</body>
</html>
